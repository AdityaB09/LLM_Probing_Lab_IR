{% extends "base.html" %}
{% block content %}
<section class="mb-6">
  <div class="flex flex-wrap items-end justify-between gap-3 mb-4">
    <div>
      <h1 class="text-2xl md:text-3xl font-semibold tracking-tight mb-1">
        Run Probes
      </h1>
      <p class="text-slate-400 text-sm max-w-xl">
        Choose a dataset, sample size, and encoder set. We’ll probe each layer
        with a logistic head and visualize how task information flows through
        the stack.
      </p>
    </div>
  </div>

  <form
    method="post"
    id="run-probes-form"
    class="card space-y-6 border border-slate-800/80"
  >
    <div class="grid md:grid-cols-3 gap-4">
      <div>
        <label class="label">Dataset</label>
        <select name="dataset" class="input">
          {% for key, meta in datasets.items() %}
          <option value="{{ key }}">{{ meta.task_name }} ({{ key }})</option>
          {% endfor %}
        </select>
        <p class="helper">
          Mapped 1-to-1 to Kaggle datasets defined in
          <code>config.py</code>.
        </p>
      </div>

      <div>
        <label class="label">Max samples</label>
        <input
          type="number"
          name="max_samples"
          value="{{ default_max_samples }}"
          min="200"
          max="{{ config.MAX_SAMPLES_HARD_LIMIT }}"
          class="input"
        />
        <p class="helper">
          Trade-off between statistical stability and runtime.
        </p>
      </div>

      <div>
        <label class="label">Models</label>
        <select
          name="models"
          class="input h-[120px] align-top"
          multiple
          size="4"
        >
          {% for m in models %}
          <option value="{{ m }}">{{ m }}</option>
          {% endfor %}
        </select>
        <p class="helper">Hold Ctrl/Cmd to select multiple encoders.</p>
      </div>
    </div>

    <div class="flex flex-wrap items-center justify-between gap-3">
      <button type="submit" class="btn-primary">
        Launch Probing Experiment
      </button>

      <div class="flex flex-wrap gap-2 text-[11px] text-slate-400">
        <span class="pill pill-soft">
          Hidden states per layer
        </span>
        <span class="pill pill-soft">
          Logistic regression probes
        </span>
        <span class="pill pill-soft">
          Accuracy / F1 / ECE curves
        </span>
      </div>
    </div>
  </form>

  <p class="text-slate-400 text-xs mt-4">
    When you hit <b>Launch</b>, we’ll download the dataset via Kaggle (if
    needed), compute hidden states for each layer, train logistic probes, and
    log all metrics with a natural-language summary. A full-screen animated
    overlay shows that the experiment is live.
  </p>
</section>
{% endblock %}
