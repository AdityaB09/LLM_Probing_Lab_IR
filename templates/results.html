{% extends "base.html" %}
{% block content %}
<section class="mb-6">
  <div class="flex flex-wrap items-center justify-between gap-3 mb-3">
    <div>
      <h1 class="text-2xl font-semibold tracking-tight mb-1">
        Results · Run #{{ run.id }}
      </h1>
      <p class="text-slate-400 text-sm">
        {{ run.dataset_name }} · {{ run.sample_size }} samples · Models:
        {{ run.models }}
      </p>
    </div>

    <a href="{{ url_for('compare') }}" class="btn-secondary text-xs">
      Compare models →
    </a>
  </div>

  {% if run.summary %}
  <div
    class="card border border-cyan-500/40 bg-gradient-to-br from-slate-950/70 via-slate-950/80 to-slate-900/90 mb-6"
  >
    <h2 class="text-sm font-semibold text-cyan-300 mb-2">
      Auto-generated narrative summary
    </h2>
    <div class="prose prose-invert text-sm max-w-none leading-relaxed">
      {{ run.summary | safe | replace('\n', '<br>') | safe }}
    </div>
  </div>
  {% endif %}
</section>

<section class="grid md:grid-cols-2 gap-6">
  <div class="panel">
    <h3 class="panel-title">Accuracy vs Layer</h3>
    <canvas id="accChart"></canvas>
  </div>
  <div class="panel">
    <h3 class="panel-title">Weighted F1 vs Layer</h3>
    <canvas id="f1Chart"></canvas>
  </div>
  <div class="panel md:col-span-2">
    <h3 class="panel-title">Calibration · Expected Calibration Error (ECE)</h3>
    <canvas id="eceChart"></canvas>
  </div>
</section>

<script>
  window.addEventListener("load", () => {
    fetch("{{ url_for('api_run_metrics', run_id=run.id) }}")
      .then((r) => r.json())
      .then((metrics) => renderRunCharts(metrics));
  });
</script>
{% endblock %}
